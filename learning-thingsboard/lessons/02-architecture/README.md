# Архітектура IIoT рішення для зернового терміналу

## Огляд архітектури

### Рівні системи
1. **Рівень пристроїв та датчиків**
   - Датчики температури та вологості в силосах
   - Ваги для автомобілів
   - Системи контролю потоку зерна
   - Лабораторне обладнання
   - ПЛК (Програмовані логічні контролери)

2. **Рівень збору даних**
   - Edge пристрої для локальної обробки
   - Шлюзи Modbus/MQTT
   - Перетворювачі протоколів
   - Локальні бази даних

3. **Рівень обробки та зберігання**
   - ThingsBoard кластер
   - Бази даних часових рядів
   - Системи аналітики
   - Сховище історичних даних

4. **Рівень візуалізації та управління**
   - Web-інтерфейс ThingsBoard
   - Мобільний додаток
   - Інтеграція з ERP
   - Системи звітності

## Компоненти системи

### 1. Приймання зерна

#### 1.1. Автомобільні ваги
```yaml
Обладнання:
  - Тип: Автомобільні ваги
  - Модель: CAS RW-15P
  - Протокол: Modbus RTU
  - Параметри:
    - Вага брутто
    - Вага тари
    - Вага нетто
    - Час зважування
    - Номер автомобіля

Інтеграція:
  - Edge пристрій: Advantech WISE-5000
  - Протокол: Modbus RTU -> MQTT
  - Частота опитування: 1 сек
  - QoS: 1
```

#### 1.2. Лабораторне обладнання
```yaml
Обладнання:
  - Вологомір зерна:
      Модель: Pfeuffer HE lite
      Протокол: RS-485
      Параметри:
        - Вологість
        - Температура
        - ID проби
  
  - Аналізатор якості:
      Модель: Infratec NOVA
      Протокол: TCP/IP
      Параметри:
        - Білок
        - Клейковина
        - Олійність
        - Домішки

Інтеграція:
  - Edge пристрій: Dell Edge Gateway 3000
  - Протокол: MQTT/Sparkplug B
  - Частота оновлення: При кожному вимірюванні
```

### 2. Зберігання зерна

#### 2.1. Силоси
```yaml
Обладнання:
  - Датчики температури:
      Тип: PT100
      Кількість: 12 на силос
      Розташування: 3 рівні по 4 датчики
      Протокол: Modbus RTU
  
  - Датчики вологості:
      Тип: Capacitive
      Кількість: 4 на силос
      Розташування: На кожному рівні
      Протокол: Modbus RTU
  
  - Датчики рівня:
      Тип: Radar
      Кількість: 1 на силос
      Протокол: 4-20mA

Інтеграція:
  - ПЛК: Siemens S7-1200
  - Edge пристрій: Siemens SIMATIC IPC Edge
  - Протокол: MQTT/Sparkplug B
  - Частота опитування:
      Температура: 5 хв
      Вологість: 15 хв
      Рівень: 1 хв
```

#### 2.2. Система аерації
```yaml
Обладнання:
  - Вентилятори:
      Тип: Частотний привід
      Протокол: Modbus TCP
      Параметри:
        - Швидкість
        - Споживана потужність
        - Статус
  
  - Датчики повітря:
      Параметри:
        - Температура
        - Вологість
        - Тиск
      Протокол: Modbus RTU

Інтеграція:
  - ПЛК: Siemens S7-1200
  - Частота опитування: 30 сек
```

### 3. Відвантаження

#### 3.1. Транспортна система
```yaml
Обладнання:
  - Конвеєри:
      Тип: Частотний привід
      Протокол: Modbus TCP
      Параметри:
        - Швидкість
        - Навантаження
        - Статус
  
  - Засувки:
      Тип: Електропривід
      Протокол: Modbus RTU
      Параметри:
        - Положення
        - Статус

Інтеграція:
  - ПЛК: Siemens S7-1500
  - Edge пристрій: Siemens SIMATIC IPC Edge
  - Протокол: MQTT/Sparkplug B
  - Частота опитування: 1 сек
```

## Мережева топологія

### 1. Польовий рівень
```yaml
Мережі:
  - Modbus RTU:
      Швидкість: 9600/19200 бод
      Топологія: Шина RS-485
      Сегменти:
        - Силоси
        - Ваги
        - Лабораторія
  
  - Ethernet/IP:
      Швидкість: 100 Мбіт/с
      Топологія: Зірка
      Сегменти:
        - ПЛК
        - Edge пристрої
        - Аналізатори
```

### 2. Рівень автоматизації
```yaml
Мережі:
  - Industrial Ethernet:
      Швидкість: 1 Гбіт/с
      Топологія: Кільце
      Протоколи:
        - Modbus TCP
        - MQTT
        - OPC UA
      Обладнання:
        - Edge шлюзи
        - ПЛК
        - Сервери
```

### 3. Рівень підприємства
```yaml
Мережі:
  - Enterprise Network:
      Швидкість: 10 Гбіт/с
      Топологія: Зірка
      Сегменти:
        - ThingsBoard кластер
        - Бази даних
        - Робочі станції
        - ERP система
```

## Потоки даних

### 1. Телеметрія
```yaml
Датчики -> Edge пристрої:
  - Протокол: Modbus RTU/TCP
  - Частота: Від 1 сек до 15 хв
  - Буферизація: Так
  - Формат: Raw data

Edge пристрої -> ThingsBoard:
  - Протокол: MQTT/Sparkplug B
  - QoS: 1
  - Буферизація: Так
  - Формат: JSON
  - Агрегація: За необхідності
```

### 2. Команди керування
```yaml
ThingsBoard -> Edge пристрої:
  - Протокол: MQTT
  - QoS: 2
  - Підтвердження: Обов'язково
  - Timeout: 5 сек

Edge пристрої -> Обладнання:
  - Протокол: Modbus
  - Підтвердження: Так
  - Retry: 3 спроби
```

### 3. Аналітичні дані
```yaml
ThingsBoard -> База даних:
  - Тип: Time-series
  - Агрегація: 
    - Raw data: 7 днів
    - 5 хв: 30 днів
    - 1 година: 1 рік
  - Backup: Щоденно

База даних -> Звіти:
  - Формат: Excel, PDF
  - Розклад: Щоденно, щотижнево
  - Доставка: Email, FTP
```

## Безпека та надійність

### 1. Мережева безпека
```yaml
Сегментація:
  - Industrial DMZ
  - VLAN для кожного рівня
  - Фаєрволи між сегментами

Шифрування:
  - TLS 1.3 для MQTT
  - VPN для віддаленого доступу
  - Сертифікати для пристроїв
```

### 2. Резервування
```yaml
Обладнання:
  - Дубльовані Edge пристрої
  - Резервні ПЛК
  - RAID для серверів

Мережі:
  - Дубльовані канали зв'язку
  - Резервні маршрутизатори
  - UPS для всього обладнання
```

### 3. Відмовостійкість
```yaml
Edge рівень:
  - Локальне кешування даних
  - Автоматичне відновлення зв'язку
  - Watchdog таймери

Серверний рівень:
  - Кластеризація ThingsBoard
  - Реплікація баз даних
  - Балансування навантаження
```
